<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IRON KNIGHTS | Medieval Mech Warfare</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="loading-screen">
        <div class="loader-content">
            <div class="mech-loader">
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-core"></div>
            </div>
            <h1 class="game-title">IRON KNIGHTS</h1>
            <p class="loading-text">INITIALIZING BATTLE SYNC<span class="dots">...</span></p>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <div id="main-menu" class="hidden">
        <div class="menu-bg"></div>
        <div class="menu-content">
            <div class="title-container">
                <div class="title-glow"></div>
                <h1 class="main-title">IRON<span class="title-accent">KNIGHTS</span></h1>
                <p class="subtitle">MEDIEVAL MECH WARFARE ‚Ä¢ 1287 AD</p>
            </div>

            <nav class="menu-nav">
                <button class="menu-btn" data-action="story-mode">
                    <span class="btn-icon">‚ñ∂</span>
                    <span class="btn-text">STORY MODE</span>
                    <span class="btn-glow"></span>
                </button>
                <button class="menu-btn" data-action="free-mode">
                    <span class="btn-icon">‚àû</span>
                    <span class="btn-text">FREE MODE</span>
                    <span class="btn-glow"></span>
                </button>
                <button class="menu-btn" data-action="hangar">
                    <span class="btn-icon">‚óÜ</span>
                    <span class="btn-text">ROYAL ARMORY</span>
                    <span class="btn-glow"></span>
                </button>
                <button class="menu-btn" data-action="controls">
                    <span class="btn-icon">‚åò</span>
                    <span class="btn-text">CONTROLS</span>
                    <span class="btn-glow"></span>
                </button>
            </nav>

            <div class="menu-footer">
                <p>¬© 1287 ROYAL ARMORY INDUSTRIES</p>
            </div>
        </div>
    </div>

    <div id="hangar-screen" class="hidden">
        <div class="hangar-bg"></div>
        <div class="hangar-content">
            <h2 class="hangar-title">ROYAL ARMORY</h2>
            <div class="hangar-gold">
                <span class="gold-icon">‚óÜ</span>
                <span id="hangar-gold">0</span>
                <span>GOLD</span>
            </div>
            <div class="mech-selection" id="mech-selection">
                <!-- Mechs will be populated by JavaScript -->
            </div>
            <button class="deploy-btn" data-action="menu">BACK TO MENU</button>
        </div>
    </div>

    <div id="controls-screen" class="hidden">
        <div class="controls-bg"></div>
        <button class="back-btn" data-action="menu">‚Üê BACK</button>
        <div class="controls-content">
            <h2 class="controls-title">PILOT CONTROLS</h2>
            <div class="controls-grid">
                <div class="control-item">
                    <div class="key">W A S D</div>
                    <span>MOVEMENT</span>
                </div>
                <div class="control-item">
                    <div class="key">MOUSE</div>
                    <span>AIM / LOOK</span>
                </div>
                <div class="control-item">
                    <div class="key">LEFT CLICK</div>
                    <span>PRIMARY FIRE</span>
                </div>
                <div class="control-item">
                    <div class="key">RIGHT CLICK</div>
                    <span>SECONDARY FIRE</span>
                </div>
                <div class="control-item">
                    <div class="key">SPACE</div>
                    <span>BOOST / FLY</span>
                </div>
                <div class="control-item">
                    <div class="key">SHIFT</div>
                    <span>SPRINT</span>
                </div>
                <div class="control-item">
                    <div class="key">E</div>
                    <span>SPECIAL ABILITY / INTERACT</span>
                </div>
                <div class="control-item">
                    <div class="key">Q</div>
                    <span>MELEE ATTACK</span>
                </div>
                <div class="control-item">
                    <div class="key">R</div>
                    <span>RELOAD</span>
                </div>
                <div class="control-item">
                    <div class="key">ESC</div>
                    <span>PAUSE MENU</span>
                </div>
                <div class="control-item">
                    <div class="key">V</div>
                    <span>TOGGLE POV</span>
                </div>
            </div>
        </div>
    </div>

    <!-- STORY MAP SCREEN - REFINED LAYOUT -->
    <div id="story-map-screen" class="hidden">
        <div class="story-map-bg"></div>
        
        <!-- Main Layout Container -->
        <div class="map-layout">
            <!-- Left Side: Map Area -->
            <div class="map-area">
                <!-- Header -->
                <div class="map-header">
                    <h2 class="story-title">KINGDOM OF IRONSPIRE</h2>
                    <p class="story-subtitle">Select your mission</p>
                </div>
                
                <!-- Map Container - Larger -->
                <div class="map-container">
                    <svg class="kingdom-map-svg" viewBox="0 0 900 700" preserveAspectRatio="xMidYMid meet">
                        <!-- Definitions -->
                        <defs>
                            <filter id="glow">
                                <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                                <feMerge>
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                            <linearGradient id="landGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#2a4a3a"/>
                                <stop offset="100%" style="stop-color:#1a3a2a"/>
                            </linearGradient>
                        </defs>
                        
                        <!-- Ocean Background -->
                        <rect x="0" y="0" width="900" height="700" fill="#0a1520"/>
                        
                        <!-- Water texture lines -->
                        <g class="water-lines" opacity="0.08">
                            <path d="M0 100 Q225 80 450 100 T900 90" stroke="#00fff9" fill="none"/>
                            <path d="M0 250 Q225 230 450 250 T900 240" stroke="#00fff9" fill="none"/>
                            <path d="M0 450 Q225 470 450 450 T900 460" stroke="#00fff9" fill="none"/>
                            <path d="M0 600 Q225 620 450 600 T900 610" stroke="#00fff9" fill="none"/>
                        </g>
                        
                        <!-- Main Island - Larger and better positioned -->
                        <path class="main-island" d="
                            M 280 80
                            Q 380 40, 500 60
                            Q 620 50, 680 100
                            Q 750 150, 770 250
                            Q 790 350, 760 450
                            Q 720 550, 620 620
                            Q 500 680, 360 680
                            Q 220 670, 150 580
                            Q 80 490, 80 380
                            Q 80 270, 130 180
                            Q 180 100, 280 80
                            Z" 
                            fill="url(#landGradient)" 
                            stroke="#4a6a5a" 
                            stroke-width="2"
                            filter="url(#glow)"/>
                        
                        <!-- Mountains -->
                        <g class="mountains" opacity="0.5">
                            <path d="M320 200 L370 120 L420 200 L470 140 L520 210 L460 220 L380 215 Z" fill="#3a5a4a"/>
                            <path d="M420 350 L470 270 L520 350 L490 365 L440 360 Z" fill="#3a5a4a"/>
                            <path d="M550 280 L590 220 L630 280 L600 290 Z" fill="#3a5a4a"/>
                        </g>
                        
                        <!-- Forests -->
                        <g class="forests" opacity="0.4">
                            <ellipse cx="280" cy="480" rx="70" ry="50" fill="#1d3a1d"/>
                            <ellipse cx="550" cy="380" rx="50" ry="35" fill="#1d3a1d"/>
                            <ellipse cx="350" cy="350" rx="45" ry="30" fill="#1d3a1d"/>
                            <ellipse cx="200" cy="350" rx="40" ry="30" fill="#1d3a1d"/>
                        </g>
                        
                        <!-- Secondary Island (future) -->
                        <path d="
                            M 750 500
                            Q 800 470, 860 490
                            Q 920 520, 930 580
                            Q 920 640, 860 670
                            Q 800 690, 750 660
                            Q 710 620, 720 560
                            Q 730 520, 750 500
                            Z" 
                            fill="#1a2a1a" 
                            stroke="#2a3a2a" 
                            opacity="0.35"/>
                        <text x="830" y="580" fill="#333" font-size="11" text-anchor="middle" font-family="Orbitron">COMING SOON</text>
                        
                        <!-- Path Lines connecting locations -->
                        <g class="map-paths">
                            <path d="M 220 560 Q 280 500 340 440" class="map-path" data-path="1"/>
                            <path d="M 370 410 Q 430 360 490 320" class="map-path" data-path="2"/>
                            <path d="M 520 290 Q 570 250 620 220" class="map-path" data-path="3"/>
                            <path d="M 620 190 Q 580 150 530 120" class="map-path" data-path="4"/>
                            <path d="M 500 110 Q 440 90 380 85" class="map-path" data-path="5"/>
                        </g>
                        
                        <!-- Compass -->
                        <g class="compass" transform="translate(820, 120)">
                            <circle cx="0" cy="0" r="35" fill="rgba(0,0,0,0.5)" stroke="#c9a227" stroke-width="1.5"/>
                            <polygon points="0,-25 5,0 0,25 -5,0" fill="#c9a227"/>
                            <polygon points="-25,0 0,5 25,0 0,-5" fill="#8a7217"/>
                            <circle cx="0" cy="0" r="6" fill="#c9a227"/>
                            <text x="0" y="-38" text-anchor="middle" fill="#c9a227" font-size="12" font-family="Orbitron">N</text>
                        </g>
                    </svg>
                    
                    <!-- Level Nodes - Repositioned for larger map -->
                    <div class="map-nodes">
                        <div class="level-node home" data-level="HOME_BASE" style="left: 24%; top: 80%;">
                            <div class="node-marker"><span>üè∞</span></div>
                            <div class="node-info">
                                <span class="node-name">Ironhold Stronghold</span>
                                <span class="node-status">HOME</span>
                            </div>
                        </div>
                        
                        <div class="level-node" data-level="VILLAGE" style="left: 38%; top: 62%;">
                            <div class="node-marker"><span>II</span></div>
                            <div class="node-info">
                                <span class="node-name">Ravenshollow Village</span>
                                <span class="node-status"></span>
                            </div>
                            <span class="lock-icon">üîí</span>
                        </div>
                        
                        <div class="level-node" data-level="FOREST" style="left: 54%; top: 45%;">
                            <div class="node-marker"><span>III</span></div>
                            <div class="node-info">
                                <span class="node-name">Darkwood Forest</span>
                                <span class="node-status"></span>
                            </div>
                            <span class="lock-icon">üîí</span>
                        </div>
                        
                        <div class="level-node" data-level="CASTLE_GATES" style="left: 68%; top: 30%;">
                            <div class="node-marker"><span>IV</span></div>
                            <div class="node-info">
                                <span class="node-name">Castle Gates</span>
                                <span class="node-status"></span>
                            </div>
                            <span class="lock-icon">üîí</span>
                        </div>
                        
                        <div class="level-node" data-level="CASTLE_KEEP" style="left: 58%; top: 16%;">
                            <div class="node-marker"><span>V</span></div>
                            <div class="node-info">
                                <span class="node-name">Castle Keep</span>
                                <span class="node-status"></span>
                            </div>
                            <span class="lock-icon">üîí</span>
                        </div>
                        
                        <div class="level-node" data-level="THRONE_ROOM" style="left: 42%; top: 10%;">
                            <div class="node-marker"><span>VI</span></div>
                            <div class="node-info">
                                <span class="node-name">Throne Room</span>
                                <span class="node-status"></span>
                            </div>
                            <span class="lock-icon">üîí</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Sidebar: Mission Panel -->
            <div class="mission-sidebar">
                <div class="sidebar-header">
                    <h3>MISSION BRIEFING</h3>
                </div>
                
                <div class="sidebar-content">
                    <div class="mission-details">
                        <h4 id="selected-mission-title">Select a Location</h4>
                        <p id="selected-mission-desc">Click on an unlocked location on the map to view mission details.</p>
                        <div class="reward-box" id="mission-reward"></div>
                    </div>
                    
                    <button class="start-btn hidden" id="start-mission-btn">BEGIN MISSION</button>
                </div>
                
                <div class="sidebar-footer">
                    <button class="deploy-btn" data-action="menu">BACK TO MENU</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MISSION COMPLETE SCREEN - FIXED -->
    <div id="mission-complete-screen" class="hidden">
        <div class="mission-complete-bg"></div>
        <div class="mission-complete-content">
            <h2 class="complete-title">MISSION COMPLETE</h2>
            <div class="complete-stats">
                <div class="complete-stat">
                    <span class="stat-label">GOLD EARNED</span>
                    <span class="stat-value gold" id="complete-gold">+0</span>
                </div>
                <div class="complete-stat">
                    <span class="stat-label">ENEMIES SLAIN</span>
                    <span class="stat-value" id="complete-kills">0</span>
                </div>
                <div class="complete-stat">
                    <span class="stat-label">TIME</span>
                    <span class="stat-value" id="complete-time">0:00</span>
                </div>
            </div>
            <div class="complete-unlock" id="complete-unlock"></div>
            <div class="complete-buttons">
                <button class="complete-btn primary" data-action="next-mission">CONTINUE</button>
                <button class="complete-btn" data-action="hangar">ARMORY</button>
                <button class="complete-btn" data-action="menu">MAIN MENU</button>
            </div>
        </div>
    </div>

    <div id="game-container" class="hidden">
        <canvas id="game-canvas"></canvas>
        
        <div id="hud">
            <!-- Gold display in-game -->
            <div class="hud-gold">
                <span class="gold-icon">‚óÜ</span>
                <span id="hud-gold-value">0</span>
            </div>
            
            <div class="hud-left">
                <div class="health-container">
                    <div class="health-icon">‚ô•</div>
                    <div class="health-bar">
                        <div class="health-fill" id="health-fill"></div>
                        <span class="health-text" id="health-text">100</span>
                    </div>
                </div>
                <div class="shield-container">
                    <div class="shield-icon">‚óá</div>
                    <div class="shield-bar">
                        <div class="shield-fill" id="shield-fill"></div>
                        <span class="shield-text" id="shield-text">100</span>
                    </div>
                </div>
                <div class="boost-container">
                    <div class="boost-icon">‚ñ≤</div>
                    <div class="boost-bar">
                        <div class="boost-fill" id="boost-fill"></div>
                    </div>
                </div>
            </div>

            <div class="hud-center">
                <div class="crosshair">
                    <div class="crosshair-dot"></div>
                    <div class="crosshair-ring"></div>
                </div>
                <div class="target-info hidden" id="target-info">
                    <span class="target-name" id="target-name">ENEMY MECH</span>
                    <div class="target-health-bar">
                        <div class="target-health-fill" id="target-health-fill"></div>
                    </div>
                </div>
            </div>

            <div class="hud-right">
                <div class="weapon-display">
                    <div class="weapon-icon" id="weapon-icon">‚¨°</div>
                    <div class="weapon-info">
                        <span class="weapon-name" id="weapon-name">ENERGY LANCE</span>
                        <span class="ammo-count"><span id="ammo-current">100</span> / <span id="ammo-max">100</span></span>
                    </div>
                </div>
                <div class="ability-display">
                    <div class="ability-icon" id="ability-icon">‚óà</div>
                    <div class="ability-cooldown" id="ability-cooldown"></div>
                </div>
            </div>

            <div class="hud-bottom">
                <div class="score-display">
                    <span class="score-label">SCORE</span>
                    <span class="score-value" id="score-value">0</span>
                </div>
                <div class="kills-display">
                    <span class="kills-label">KILLS</span>
                    <span class="kills-value" id="kills-value">0</span>
                </div>
                <div class="wave-display">
                    <span class="wave-label">WAVE</span>
                    <span class="wave-value" id="wave-value">1</span>
                </div>
            </div>

            <div class="minimap">
                <canvas id="minimap-canvas"></canvas>
                <div class="minimap-border"></div>
            </div>

            <div class="damage-indicator left"></div>
            <div class="damage-indicator right"></div>
            <div class="damage-indicator top"></div>
            <div class="damage-indicator bottom"></div>
        </div>

        <div id="boss-health-container" class="hidden">
            <span id="boss-name">BOSS NAME</span>
            <div class="boss-health-bar">
                <div id="boss-health-fill" style="width: 100%;"></div>
            </div>
            <div class="boss-phase-indicators">
                <span class="phase active"></span>
                <span class="phase"></span>
                <span class="phase"></span>
                <span class="phase"></span>
            </div>
        </div>

        <div id="mission-objectives" class="hidden">
            <h4 id="mission-title">MISSION</h4>
            <ul id="objective-list"></ul>
        </div>

        <div id="interaction-prompt" class="hidden">
            <span>Press E to Interact</span>
        </div>

        <div id="dialogue-box" class="hidden">
            <div class="dialogue-content">
                <span id="dialogue-speaker"></span>
                <p id="dialogue-text"></p>
                <span class="dialogue-hint">Click to continue...</span>
            </div>
        </div>

        <div id="pause-menu" class="hidden">
            <div class="pause-overlay"></div>
            <div class="pause-content">
                <h2>PAUSED</h2>
                <button class="pause-btn" data-action="resume">RESUME</button>
                <button class="pause-btn" data-action="restart">RESTART</button>
                <button class="pause-btn" data-action="menu">MAIN MENU</button>
            </div>
        </div>

        <div id="game-over" class="hidden">
            <div class="game-over-overlay"></div>
            <div class="game-over-content">
                <h2 class="game-over-title">MECH DESTROYED</h2>
                <div class="final-stats">
                    <div class="stat"><span>FINAL SCORE</span><span id="final-score">0</span></div>
                    <div class="stat"><span>KILLS</span><span id="final-kills">0</span></div>
                    <div class="stat"><span>WAVES SURVIVED</span><span id="final-waves">0</span></div>
                </div>
                <button class="restart-btn" data-action="restart">DEPLOY AGAIN</button>
                <button class="menu-btn-small" data-action="menu">MAIN MENU</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="game.js"></script>
</body>
</html>