<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IRON KNIGHTS | Medieval Mech Warfare</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="loading-screen">
        <div class="loader-content">
            <div class="mech-loader">
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-core"></div>
            </div>
            <h1 class="game-title">IRON KNIGHTS</h1>
            <p class="loading-text">INITIALIZING BATTLE SYNC<span class="dots">...</span></p>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <div id="main-menu" class="hidden">
        <div class="menu-bg"></div>
        <div class="menu-content">
            <div class="title-container">
                <div class="title-glow"></div>
                <h1 class="main-title">IRON<span class="title-accent">KNIGHTS</span></h1>
                <p class="subtitle">MEDIEVAL MECH WARFARE ‚Ä¢ 1287 AD</p>
            </div>

            <nav class="menu-nav">
                <button class="menu-btn" data-action="story-mode">
                    <span class="btn-icon">‚ñ∂</span>
                    <span class="btn-text">STORY MODE</span>
                    <span class="btn-glow"></span>
                </button>
                <button class="menu-btn" data-action="free-mode">
                    <span class="btn-icon">‚àû</span>
                    <span class="btn-text">FREE MODE</span>
                    <span class="btn-glow"></span>
                </button>
                <button class="menu-btn" data-action="hangar">
                    <span class="btn-icon">‚óÜ</span>
                    <span class="btn-text">ROYAL ARMORY</span>
                    <span class="btn-glow"></span>
                </button>
                <button class="menu-btn" data-action="controls">
                    <span class="btn-icon">‚åò</span>
                    <span class="btn-text">CONTROLS</span>
                    <span class="btn-glow"></span>
                </button>
            </nav>

            <div class="menu-footer">
                <p>¬© 1287 ROYAL ARMORY INDUSTRIES</p>
            </div>
        </div>
    </div>

    <div id="hangar-screen" class="hidden">
        <div class="hangar-bg"></div>
        <div class="hangar-content">
            <h2 class="hangar-title">ROYAL ARMORY</h2>
            <div class="hangar-gold">
                <span class="gold-icon">‚óÜ</span>
                <span id="hangar-gold">0</span>
                <span>GOLD</span>
            </div>
            <div class="mech-selection" id="mech-selection">
                <!-- Mechs will be populated by JavaScript -->
            </div>
            <button class="deploy-btn" data-action="menu">BACK TO MENU</button>
        </div>
    </div>

    <div id="controls-screen" class="hidden">
        <div class="controls-bg"></div>
        <button class="back-btn" data-action="menu">‚Üê BACK</button>
        <div class="controls-content">
            <h2 class="controls-title">PILOT CONTROLS</h2>
            <div class="controls-grid">
                <div class="control-item">
                    <div class="key">W A S D</div>
                    <span>MOVEMENT</span>
                </div>
                <div class="control-item">
                    <div class="key">MOUSE</div>
                    <span>AIM / LOOK</span>
                </div>
                <div class="control-item">
                    <div class="key">LEFT CLICK</div>
                    <span>PRIMARY FIRE</span>
                </div>
                <div class="control-item">
                    <div class="key">RIGHT CLICK</div>
                    <span>SECONDARY FIRE</span>
                </div>
                <div class="control-item">
                    <div class="key">SPACE</div>
                    <span>BOOST / FLY</span>
                </div>
                <div class="control-item">
                    <div class="key">SHIFT</div>
                    <span>SPRINT</span>
                </div>
                <div class="control-item">
                    <div class="key">E</div>
                    <span>SPECIAL ABILITY / INTERACT</span>
                </div>
                <div class="control-item">
                    <div class="key">Q</div>
                    <span>MELEE ATTACK</span>
                </div>
                <div class="control-item">
                    <div class="key">R</div>
                    <span>RELOAD</span>
                </div>
                <div class="control-item">
                    <div class="key">ESC</div>
                    <span>PAUSE MENU</span>
                </div>
                <div class="control-item">
                    <div class="key">V</div>
                    <span>TOGGLE POV</span>
                </div>
            </div>
        </div>
    </div>

    <!-- STORY MAP SCREEN - REFINED LAYOUT -->
    <div id="story-map-screen" class="hidden">
        <div class="story-map-bg"></div>
        
        <!-- Main Layout Container -->
        <div class="map-layout">
            <!-- Left Side: Map Area -->
            <div class="map-area">
                <!-- Header -->
                <div class="map-header">
                    <h2 class="story-title">KINGDOM OF IRONSPIRE</h2>
                    <p class="story-subtitle">Select your mission</p>
                </div>
                
                <!-- Map Container - Larger -->
                <div class="map-container">
                    <svg class="kingdom-map-svg" viewBox="0 0 100 100" preserveAspectRatio="none">
                        <!-- Definitions -->
                        <defs>
                            <filter id="glow">
                                <feGaussianBlur stdDeviation="0.5" result="coloredBlur"/>
                                <feMerge>
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                            <linearGradient id="landGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#3a6a4a"/>
                                <stop offset="50%" style="stop-color:#2a5a3a"/>
                                <stop offset="100%" style="stop-color:#1a4a2a"/>
                            </linearGradient>
                            <linearGradient id="mountainGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#6a7a8a"/>
                                <stop offset="100%" style="stop-color:#4a5a6a"/>
                            </linearGradient>
                        </defs>
                        
                        <!-- Ocean Background -->
                        <rect x="0" y="0" width="100" height="100" fill="#1a3a5a"/>
                        
                        <!-- Water waves -->
                        <g class="water-waves" opacity="0.15">
                            <ellipse cx="10" cy="20" rx="8" ry="3" fill="#2a5a8a"/>
                            <ellipse cx="85" cy="15" rx="6" ry="2" fill="#2a5a8a"/>
                            <ellipse cx="15" cy="85" rx="7" ry="2.5" fill="#2a5a8a"/>
                            <ellipse cx="90" cy="75" rx="5" ry="2" fill="#2a5a8a"/>
                            <ellipse cx="5" cy="50" rx="4" ry="1.5" fill="#2a5a8a"/>
                        </g>
                        
                        <!-- Main Island - Larger, covering most of the map -->
                        <path class="main-island" d="
                            M 10 45
                            Q 8 30, 20 18
                            Q 35 5, 55 8
                            Q 75 10, 85 25
                            Q 95 40, 92 55
                            Q 90 70, 80 82
                            Q 65 95, 45 95
                            Q 25 93, 15 80
                            Q 5 65, 10 45
                            Z" 
                            fill="url(#landGradient)" 
                            stroke="#2a4a3a" 
                            stroke-width="0.5"
                            filter="url(#glow)"/>
                        
                        <!-- Beaches/shores -->
                        <ellipse cx="20" cy="88" rx="8" ry="3" fill="#8a7a5a" opacity="0.4"/>
                        <ellipse cx="75" cy="85" rx="6" ry="2" fill="#8a7a5a" opacity="0.4"/>
                        <ellipse cx="90" cy="50" rx="3" ry="6" fill="#8a7a5a" opacity="0.3"/>
                        
                        <!-- Mountains - Central area -->
                        <g class="mountains">
                            <!-- Large mountain range in center-top -->
                            <path d="M40 35 L48 15 L56 35 Z" fill="url(#mountainGrad)"/>
                            <path d="M48 38 L55 20 L62 38 Z" fill="#5a6a7a"/>
                            <path d="M55 40 L62 25 L69 40 Z" fill="url(#mountainGrad)"/>
                            <!-- Snow caps -->
                            <path d="M46 20 L48 15 L50 20 Z" fill="#ddd"/>
                            <path d="M53 25 L55 20 L57 25 Z" fill="#ddd"/>
                            <path d="M60 30 L62 25 L64 30 Z" fill="#ddd"/>
                        </g>
                        
                        <!-- Forests - Dark green patches -->
                        <g class="forests">
                            <ellipse cx="25" cy="75" rx="10" ry="6" fill="#1a3a1a" opacity="0.7"/>
                            <ellipse cx="70" cy="65" rx="8" ry="5" fill="#1a3a1a" opacity="0.6"/>
                            <ellipse cx="35" cy="55" rx="7" ry="4" fill="#1a3a1a" opacity="0.5"/>
                            <ellipse cx="55" cy="70" rx="6" ry="4" fill="#1a3a1a" opacity="0.5"/>
                            <ellipse cx="80" cy="45" rx="5" ry="3" fill="#1a3a1a" opacity="0.4"/>
                        </g>
                        
                        <!-- Small trees scattered -->
                        <g class="trees" fill="#2a5a2a" opacity="0.6">
                            <circle cx="20" cy="70" r="1.5"/>
                            <circle cx="28" cy="78" r="1.2"/>
                            <circle cx="32" cy="72" r="1"/>
                            <circle cx="65" cy="60" r="1.3"/>
                            <circle cx="72" cy="68" r="1"/>
                            <circle cx="78" cy="55" r="1.2"/>
                        </g>
                        
                        <!-- Rivers -->
                        <path d="M50 30 Q45 45 50 60 Q55 75 45 88" 
                              stroke="#3a7aaa" stroke-width="0.8" fill="none" opacity="0.5"/>
                        
                        <!-- Path Lines connecting locations -->
                        <g class="map-paths">
                            <!-- HOME (18,85) to VILLAGE (32,65) -->
                            <path d="M 18 85 L 32 65" class="map-path" data-path="1"/>
                            <!-- VILLAGE (32,65) to FOREST (50,50) -->
                            <path d="M 32 65 L 50 50" class="map-path" data-path="2"/>
                            <!-- FOREST (50,50) to CASTLE_GATES (72,42) -->
                            <path d="M 50 50 L 72 42" class="map-path" data-path="3"/>
                            <!-- CASTLE_GATES (72,42) to CASTLE_KEEP (52,28) -->
                            <path d="M 72 42 L 52 28" class="map-path" data-path="4"/>
                            <!-- CASTLE_KEEP (52,28) to THRONE_ROOM (32,30) -->
                            <path d="M 52 28 L 32 30" class="map-path" data-path="5"/>
                        </g>
                    </svg>
                    
                    <!-- Compass - Outside SVG to avoid stretching -->
                    <div class="map-compass">
                        <span class="compass-n">N</span>
                        <div class="compass-rose">
                            <div class="compass-arrow ns"></div>
                            <div class="compass-arrow ew"></div>
                        </div>
                    </div>

                    <!-- Level Nodes - Repositioned to fit island -->
                    <div class="map-nodes">
                        <div class="level-node home" data-level="HOME_BASE" style="left: 18%; top: 85%;">
                            <div class="node-marker"><span>üè∞</span></div>
                            <div class="node-info">
                                <span class="node-name">Ironhold Stronghold</span>
                                <span class="node-status">HOME</span>
                            </div>
                        </div>
                        
                        <div class="level-node" data-level="VILLAGE" style="left: 32%; top: 65%;">
                            <div class="node-marker"><span>II</span></div>
                            <div class="node-info">
                                <span class="node-name">Ravenshollow Village</span>
                                <span class="node-status"></span>
                            </div>
                            <span class="lock-icon">üîí</span>
                        </div>
                        
                        <div class="level-node" data-level="FOREST" style="left: 50%; top: 50%;">
                            <div class="node-marker"><span>III</span></div>
                            <div class="node-info">
                                <span class="node-name">Darkwood Forest</span>
                                <span class="node-status"></span>
                            </div>
                            <span class="lock-icon">üîí</span>
                        </div>
                        
                        <div class="level-node" data-level="CASTLE_GATES" style="left: 72%; top: 42%;">
                            <div class="node-marker"><span>IV</span></div>
                            <div class="node-info">
                                <span class="node-name">Castle Gates</span>
                                <span class="node-status"></span>
                            </div>
                            <span class="lock-icon">üîí</span>
                        </div>
                        
                        <div class="level-node" data-level="CASTLE_KEEP" style="left: 52%; top: 28%;">
                            <div class="node-marker"><span>V</span></div>
                            <div class="node-info">
                                <span class="node-name">Castle Keep</span>
                                <span class="node-status"></span>
                            </div>
                            <span class="lock-icon">üîí</span>
                        </div>
                        
                        <div class="level-node" data-level="THRONE_ROOM" style="left: 32%; top: 30%;">
                            <div class="node-marker"><span>VI</span></div>
                            <div class="node-info">
                                <span class="node-name">Throne Room</span>
                                <span class="node-status"></span>
                            </div>
                            <span class="lock-icon">üîí</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Sidebar: Mission Panel -->
            <div class="mission-sidebar">
                <div class="sidebar-header">
                    <h3>MISSION BRIEFING</h3>
                </div>
                
                <div class="sidebar-content">
                    <div class="mission-details">
                        <h4 id="selected-mission-title">Select a Location</h4>
                        <p id="selected-mission-desc">Click on an unlocked location on the map to view mission details.</p>
                        <div class="reward-box" id="mission-reward"></div>
                    </div>
                    
                    <button class="start-btn hidden" id="start-mission-btn">BEGIN MISSION</button>
                </div>
                
                <div class="sidebar-footer">
                    <button class="deploy-btn" data-action="menu">BACK TO MENU</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MISSION COMPLETE SCREEN - FIXED -->
    <div id="mission-complete-screen" class="hidden">
        <div class="mission-complete-bg"></div>
        <div class="mission-complete-content">
            <h2 class="complete-title">MISSION COMPLETE</h2>
            <div class="complete-stats">
                <div class="complete-stat">
                    <span class="stat-label">GOLD EARNED</span>
                    <span class="stat-value gold" id="complete-gold">+0</span>
                </div>
                <div class="complete-stat">
                    <span class="stat-label">ENEMIES SLAIN</span>
                    <span class="stat-value" id="complete-kills">0</span>
                </div>
                <div class="complete-stat">
                    <span class="stat-label">TIME</span>
                    <span class="stat-value" id="complete-time">0:00</span>
                </div>
            </div>
            <div class="complete-unlock" id="complete-unlock"></div>
            <div class="complete-buttons">
                <button class="complete-btn primary" data-action="next-mission">CONTINUE</button>
                <button class="complete-btn" data-action="hangar">ARMORY</button>
                <button class="complete-btn" data-action="menu">MAIN MENU</button>
            </div>
        </div>
    </div>

    <div id="game-container" class="hidden">
        <canvas id="game-canvas"></canvas>
        
        <div id="hud">
            <!-- Gold display in-game -->
            <div class="hud-gold">
                <span class="gold-icon">‚óÜ</span>
                <span id="hud-gold-value">0</span>
            </div>
            
            <div class="hud-left">
                <div class="health-container">
                    <div class="health-icon">‚ô•</div>
                    <div class="health-bar">
                        <div class="health-fill" id="health-fill"></div>
                        <span class="health-text" id="health-text">100</span>
                    </div>
                </div>
                <div class="shield-container">
                    <div class="shield-icon">‚óá</div>
                    <div class="shield-bar">
                        <div class="shield-fill" id="shield-fill"></div>
                        <span class="shield-text" id="shield-text">100</span>
                    </div>
                </div>
                <div class="boost-container">
                    <div class="boost-icon">‚ñ≤</div>
                    <div class="boost-bar">
                        <div class="boost-fill" id="boost-fill"></div>
                    </div>
                </div>
            </div>

            <div class="hud-center">
                <div class="crosshair">
                    <div class="crosshair-dot"></div>
                    <div class="crosshair-ring"></div>
                </div>
                <div class="target-info hidden" id="target-info">
                    <span class="target-name" id="target-name">ENEMY MECH</span>
                    <div class="target-health-bar">
                        <div class="target-health-fill" id="target-health-fill"></div>
                    </div>
                </div>
            </div>

            <div class="hud-right">
                <div class="weapon-display">
                    <div class="weapon-icon" id="weapon-icon">‚¨°</div>
                    <div class="weapon-info">
                        <span class="weapon-name" id="weapon-name">ENERGY LANCE</span>
                        <span class="ammo-count"><span id="ammo-current">100</span> / <span id="ammo-max">100</span></span>
                    </div>
                </div>
                <div class="ability-display">
                    <div class="ability-icon" id="ability-icon">‚óà</div>
                    <div class="ability-cooldown" id="ability-cooldown"></div>
                </div>
            </div>

            <div class="hud-bottom">
                <div class="score-display">
                    <span class="score-label">SCORE</span>
                    <span class="score-value" id="score-value">0</span>
                </div>
                <div class="kills-display">
                    <span class="kills-label">KILLS</span>
                    <span class="kills-value" id="kills-value">0</span>
                </div>
                <div class="wave-display">
                    <span class="wave-label">WAVE</span>
                    <span class="wave-value" id="wave-value">1</span>
                </div>
            </div>

            <div class="minimap">
                <canvas id="minimap-canvas"></canvas>
                <div class="minimap-border"></div>
            </div>

            <div class="damage-indicator left"></div>
            <div class="damage-indicator right"></div>
            <div class="damage-indicator top"></div>
            <div class="damage-indicator bottom"></div>
        </div>

        <div id="boss-health-container" class="hidden">
            <span id="boss-name">BOSS NAME</span>
            <div class="boss-health-bar">
                <div id="boss-health-fill" style="width: 100%;"></div>
            </div>
            <div class="boss-phase-indicators">
                <span class="phase active"></span>
                <span class="phase"></span>
                <span class="phase"></span>
                <span class="phase"></span>
            </div>
        </div>

        <div id="mission-objectives" class="hidden">
            <h4 id="mission-title">MISSION</h4>
            <ul id="objective-list"></ul>
        </div>

        <div id="interaction-prompt" class="hidden">
            <span>Press E to Interact</span>
        </div>

        <div id="dialogue-box" class="hidden">
            <div class="dialogue-content">
                <span id="dialogue-speaker"></span>
                <p id="dialogue-text"></p>
                <span class="dialogue-hint">Click to continue...</span>
            </div>
        </div>

        <div id="pause-menu" class="hidden">
            <div class="pause-overlay"></div>
            <div class="pause-content">
                <h2>PAUSED</h2>
                <button class="pause-btn" data-action="resume">RESUME</button>
                <button class="pause-btn" data-action="restart">RESTART</button>
                <button class="pause-btn" data-action="menu">MAIN MENU</button>
            </div>
        </div>

        <div id="game-over" class="hidden">
            <div class="game-over-overlay"></div>
            <div class="game-over-content">
                <h2 class="game-over-title">MECH DESTROYED</h2>
                <div class="final-stats">
                    <div class="stat"><span>FINAL SCORE</span><span id="final-score">0</span></div>
                    <div class="stat"><span>KILLS</span><span id="final-kills">0</span></div>
                    <div class="stat"><span>WAVES SURVIVED</span><span id="final-waves">0</span></div>
                </div>
                <button class="restart-btn" data-action="restart">DEPLOY AGAIN</button>
                <button class="menu-btn-small" data-action="menu">MAIN MENU</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="game.js"></script>
</body>
</html>