<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IRON KNIGHTS | Medieval Mech Warfare</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="loading-screen">
        <div class="loader-content">
            <div class="mech-loader">
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-core"></div>
            </div>
            <h1 class="game-title">IRON KNIGHTS</h1>
            <p class="loading-text">INITIALIZING BATTLE SYNC<span class="dots">...</span></p>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <div id="main-menu" class="hidden">
        <div class="menu-bg"></div>
        <div class="menu-content">
            <div class="title-container">
                <div class="title-glow"></div>
                <h1 class="main-title">IRON<span class="title-accent">KNIGHTS</span></h1>
                <p class="subtitle">MEDIEVAL MECH WARFARE ‚Ä¢ 1287 AD</p>
            </div>

            <nav class="menu-nav">
                <button class="menu-btn" data-action="story-mode">
                    <span class="btn-icon">‚ñ∂</span>
                    <span class="btn-text">STORY MODE</span>
                    <span class="btn-glow"></span>
                </button>
                <button class="menu-btn" data-action="free-mode">
                    <span class="btn-icon">‚àû</span>
                    <span class="btn-text">FREE MODE</span>
                    <span class="btn-glow"></span>
                </button>
                <button class="menu-btn" data-action="hangar">
                    <span class="btn-icon">‚óÜ</span>
                    <span class="btn-text">ROYAL ARMORY</span>
                    <span class="btn-glow"></span>
                </button>
                <button class="menu-btn" data-action="controls">
                    <span class="btn-icon">‚åò</span>
                    <span class="btn-text">CONTROLS</span>
                    <span class="btn-glow"></span>
                </button>
            </nav>

            <div class="menu-footer">
                <p>¬© 1287 ROYAL ARMORY INDUSTRIES</p>
            </div>
        </div>
    </div>

    <div id="hangar-screen" class="hidden">
        <div class="hangar-bg"></div>
        <div class="hangar-content">
            <h2 class="hangar-title">ROYAL ARMORY</h2>
            <div class="hangar-gold">
                <span class="gold-icon">‚óÜ</span>
                <span id="hangar-gold">0</span>
                <span>GOLD</span>
            </div>
            <div class="mech-selection" id="mech-selection">
                <!-- Mechs will be populated by JavaScript -->
            </div>
            <button class="deploy-btn" data-action="menu">BACK TO MENU</button>
        </div>
    </div>

    <div id="controls-screen" class="hidden">
        <div class="controls-bg"></div>
        <button class="back-btn" data-action="menu">‚Üê BACK</button>
        <div class="controls-content">
            <h2 class="controls-title">PILOT CONTROLS</h2>
            <div class="controls-grid">
                <div class="control-item">
                    <div class="key">W A S D</div>
                    <span>MOVEMENT</span>
                </div>
                <div class="control-item">
                    <div class="key">MOUSE</div>
                    <span>AIM / LOOK</span>
                </div>
                <div class="control-item">
                    <div class="key">LEFT CLICK</div>
                    <span>PRIMARY FIRE</span>
                </div>
                <div class="control-item">
                    <div class="key">RIGHT CLICK</div>
                    <span>SECONDARY FIRE</span>
                </div>
                <div class="control-item">
                    <div class="key">SPACE</div>
                    <span>BOOST / FLY</span>
                </div>
                <div class="control-item">
                    <div class="key">SHIFT</div>
                    <span>SPRINT</span>
                </div>
                <div class="control-item">
                    <div class="key">E</div>
                    <span>SPECIAL ABILITY / INTERACT</span>
                </div>
                <div class="control-item">
                    <div class="key">Q</div>
                    <span>MELEE ATTACK</span>
                </div>
                <div class="control-item">
                    <div class="key">R</div>
                    <span>RELOAD</span>
                </div>
                <div class="control-item">
                    <div class="key">ESC</div>
                    <span>PAUSE MENU</span>
                </div>
                <div class="control-item">
                    <div class="key">V</div>
                    <span>TOGGLE POV</span>
                </div>
            </div>
        </div>
    </div>

    <!-- STORY MAP SCREEN - FIXED -->
    <div id="story-map-screen" class="hidden">
        <div class="story-map-bg"></div>
        
        <div class="story-map-content">
            <h2 class="story-title">KINGDOM OF IRONSPIRE</h2>
            <p class="story-subtitle">Select your mission</p>
            
            <div class="world-map">
                <!-- Country Map Background -->
                <div class="map-background">
                    <svg class="map-terrain" viewBox="0 0 1000 600" preserveAspectRatio="none">
                        <!-- Mountains -->
                        <path d="M 0 400 Q 200 300 400 350 T 800 320 L 1000 300 L 1000 600 L 0 600 Z" 
                              fill="#3a4a3a" opacity="0.3" class="terrain-mountains"/>
                        <!-- Forests -->
                        <path d="M 300 500 Q 500 450 700 480 T 1000 460 L 1000 600 L 300 600 Z" 
                              fill="#2d4a2d" opacity="0.4" class="terrain-forest"/>
                        <!-- Plains/Roads -->
                        <path d="M 0 550 L 1000 500 L 1000 600 L 0 600 Z" 
                              fill="#567d46" opacity="0.2" class="terrain-plains"/>
                        <!-- Path lines connecting locations -->
                        <path d="M 120 300 L 250 300" class="map-path" data-path="1"/>
                        <path d="M 280 300 L 450 250" class="map-path" data-path="2"/>
                        <path d="M 480 250 L 650 250" class="map-path" data-path="3"/>
                        <path d="M 680 250 L 800 350" class="map-path" data-path="4"/>
                        <path d="M 680 250 L 900 150" class="map-path" data-path="5"/>
                    </svg>
                </div>
                
                <!-- Level Nodes positioned on map -->
                <div class="level-node home" data-level="HOME_BASE" style="left:12%; top:50%;">
                    <div class="node-icon-box"><span>üè∞</span></div>
                    <span class="node-name">Ironhold Stronghold</span>
                    <span class="node-status">HOME</span>
                </div>
                <div class="level-node unlocked" data-level="VILLAGE" style="left:25%; top:50%;">
                    <div class="node-icon-box"><span>II</span></div>
                    <span class="node-name">Ravenshollow Village</span>
                    <span class="node-status">START</span>
                </div>
                <div class="level-node locked" data-level="FOREST" style="left:45%; top:42%;">
                    <div class="node-icon-box"><span>III</span></div>
                    <span class="node-name">Darkwood Forest</span>
                    <span class="node-lock-icon">üîí</span>
                </div>
                <div class="level-node locked" data-level="CASTLE_GATES" style="left:65%; top:42%;">
                    <div class="node-icon-box"><span>IV</span></div>
                    <span class="node-name">Castle Gates</span>
                    <span class="node-lock-icon">üîí</span>
                </div>
                <div class="level-node locked" data-level="CASTLE_KEEP" style="left:80%; top:58%;">
                    <div class="node-icon-box"><span>V</span></div>
                    <span class="node-name">Castle Keep</span>
                    <span class="node-lock-icon">üîí</span>
                </div>
                <div class="level-node locked boss" data-level="THRONE_ROOM" style="left:90%; top:25%;">
                    <div class="node-icon-box"><span>VI</span></div>
                    <span class="node-name">Throne Room</span>
                    <span class="node-lock-icon">üîí</span>
                </div>
            </div>

            <div class="story-ui-bottom">
                <div class="mission-panel" id="mission-panel">
                    <h3 id="selected-mission-title">Select a Location</h3>
                    <p id="selected-mission-desc">Click on an unlocked location to begin your mission.</p>
                    <div class="mission-reward" id="mission-reward"></div>
                    <button class="start-mission-btn hidden" id="start-mission-btn">START MISSION</button>
                </div>
            </div>
            
            <button class="deploy-btn" data-action="menu" style="margin-top: 20px;">BACK TO MENU</button>
        </div>
    </div>

    <!-- MISSION COMPLETE SCREEN - FIXED -->
    <div id="mission-complete-screen" class="hidden">
        <div class="mission-complete-bg"></div>
        <div class="mission-complete-content">
            <h2 class="complete-title">MISSION COMPLETE</h2>
            <div class="complete-stats">
                <div class="complete-stat">
                    <span class="stat-label">GOLD EARNED</span>
                    <span class="stat-value gold" id="complete-gold">+0</span>
                </div>
                <div class="complete-stat">
                    <span class="stat-label">ENEMIES SLAIN</span>
                    <span class="stat-value" id="complete-kills">0</span>
                </div>
                <div class="complete-stat">
                    <span class="stat-label">TIME</span>
                    <span class="stat-value" id="complete-time">0:00</span>
                </div>
            </div>
            <div class="complete-unlock" id="complete-unlock"></div>
            <div class="complete-buttons">
                <button class="complete-btn primary" data-action="next-mission">CONTINUE</button>
                <button class="complete-btn" data-action="hangar">ARMORY</button>
                <button class="complete-btn" data-action="menu">MAIN MENU</button>
            </div>
        </div>
    </div>

    <div id="game-container" class="hidden">
        <canvas id="game-canvas"></canvas>
        
        <div id="hud">
            <!-- Gold display in-game -->
            <div class="hud-gold">
                <span class="gold-icon">‚óÜ</span>
                <span id="hud-gold-value">0</span>
            </div>
            
            <div class="hud-left">
                <div class="health-container">
                    <div class="health-icon">‚ô•</div>
                    <div class="health-bar">
                        <div class="health-fill" id="health-fill"></div>
                        <span class="health-text" id="health-text">100</span>
                    </div>
                </div>
                <div class="shield-container">
                    <div class="shield-icon">‚óá</div>
                    <div class="shield-bar">
                        <div class="shield-fill" id="shield-fill"></div>
                        <span class="shield-text" id="shield-text">100</span>
                    </div>
                </div>
                <div class="boost-container">
                    <div class="boost-icon">‚ñ≤</div>
                    <div class="boost-bar">
                        <div class="boost-fill" id="boost-fill"></div>
                    </div>
                </div>
            </div>

            <div class="hud-center">
                <div class="crosshair">
                    <div class="crosshair-dot"></div>
                    <div class="crosshair-ring"></div>
                </div>
                <div class="target-info hidden" id="target-info">
                    <span class="target-name" id="target-name">ENEMY MECH</span>
                    <div class="target-health-bar">
                        <div class="target-health-fill" id="target-health-fill"></div>
                    </div>
                </div>
            </div>

            <div class="hud-right">
                <div class="weapon-display">
                    <div class="weapon-icon" id="weapon-icon">‚¨°</div>
                    <div class="weapon-info">
                        <span class="weapon-name" id="weapon-name">ENERGY LANCE</span>
                        <span class="ammo-count"><span id="ammo-current">100</span> / <span id="ammo-max">100</span></span>
                    </div>
                </div>
                <div class="ability-display">
                    <div class="ability-icon" id="ability-icon">‚óà</div>
                    <div class="ability-cooldown" id="ability-cooldown"></div>
                </div>
            </div>

            <div class="hud-bottom">
                <div class="score-display">
                    <span class="score-label">SCORE</span>
                    <span class="score-value" id="score-value">0</span>
                </div>
                <div class="kills-display">
                    <span class="kills-label">KILLS</span>
                    <span class="kills-value" id="kills-value">0</span>
                </div>
                <div class="wave-display">
                    <span class="wave-label">WAVE</span>
                    <span class="wave-value" id="wave-value">1</span>
                </div>
            </div>

            <div class="minimap">
                <canvas id="minimap-canvas"></canvas>
                <div class="minimap-border"></div>
            </div>

            <div class="damage-indicator left"></div>
            <div class="damage-indicator right"></div>
            <div class="damage-indicator top"></div>
            <div class="damage-indicator bottom"></div>
        </div>

        <div id="boss-health-container" class="hidden">
            <span id="boss-name">BOSS NAME</span>
            <div class="boss-health-bar">
                <div id="boss-health-fill" style="width: 100%;"></div>
            </div>
            <div class="boss-phase-indicators">
                <span class="phase active"></span>
                <span class="phase"></span>
                <span class="phase"></span>
                <span class="phase"></span>
            </div>
        </div>

        <div id="mission-objectives" class="hidden">
            <h4 id="mission-title">MISSION</h4>
            <ul id="objective-list"></ul>
        </div>

        <div id="interaction-prompt" class="hidden">
            <span>Press E to Interact</span>
        </div>

        <div id="dialogue-box" class="hidden">
            <div class="dialogue-content">
                <span id="dialogue-speaker"></span>
                <p id="dialogue-text"></p>
                <span class="dialogue-hint">Click to continue...</span>
            </div>
        </div>

        <div id="pause-menu" class="hidden">
            <div class="pause-overlay"></div>
            <div class="pause-content">
                <h2>PAUSED</h2>
                <button class="pause-btn" data-action="resume">RESUME</button>
                <button class="pause-btn" data-action="restart">RESTART</button>
                <button class="pause-btn" data-action="menu">MAIN MENU</button>
            </div>
        </div>

        <div id="game-over" class="hidden">
            <div class="game-over-overlay"></div>
            <div class="game-over-content">
                <h2 class="game-over-title">MECH DESTROYED</h2>
                <div class="final-stats">
                    <div class="stat"><span>FINAL SCORE</span><span id="final-score">0</span></div>
                    <div class="stat"><span>KILLS</span><span id="final-kills">0</span></div>
                    <div class="stat"><span>WAVES SURVIVED</span><span id="final-waves">0</span></div>
                </div>
                <button class="restart-btn" data-action="restart">DEPLOY AGAIN</button>
                <button class="menu-btn-small" data-action="menu">MAIN MENU</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="game.js"></script>
</body>
</html>